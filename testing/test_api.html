<!DOCTYPE html>
<html>
<head>
    <title>API Test</title>
</head>
<body>
    <h1>API Endpoint Test</h1>
    <button onclick="testAPI()">Test Submit Complaint API</button>
    <div id="result" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc;"></div>

    <script>
        async function testAPI() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Testing...';

            // Create test form data
            const formData = new FormData();
            formData.append('jenis', 'aduan');
            formData.append('perkara', 'Test Complaint');
            formData.append('keterangan', 'This is a test complaint to verify API is working');
            formData.append('nama', 'Test User');
            formData.append('emel', 'test@jpbdselangor.gov.my');
            formData.append('jawatan', 'Tester');
            formData.append('bahagian', 'IT');
            formData.append('sambungan', '1234');
            formData.append('tingkat', '1');
            formData.append('jenisAset', 'komputer');
            formData.append('noPendaftaran', 'TEST-001');
            formData.append('tarikhKerosakan', '2025-01-15');
            formData.append('perihalKerosakan', 'Test Issue');
            formData.append('perihalKerosakanValue', 'komputer_hang');

            try {
                console.log('Calling API: api/submit_complaint.php');

                const response = await fetch('api/submit_complaint.php', {
                    method: 'POST',
                    body: formData
                });

                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);

                const responseText = await response.text();
                console.log('Response text:', responseText);

                resultDiv.innerHTML = `
                    <h3>Response Status: ${response.status}</h3>
                    <h3>Response:</h3>
                    <pre>${responseText}</pre>
                    <h3>Console Log:</h3>
                    <p>Check browser console (F12) for more details</p>
                `;

                // Try to parse as JSON
                try {
                    const result = JSON.parse(responseText);
                    console.log('Parsed JSON:', result);

                    if (result.success) {
                        resultDiv.innerHTML += '<h2 style="color: green;">✓ API Test Successful!</h2>';
                        resultDiv.innerHTML += `<p>Ticket Number: ${result.data.ticket_number}</p>`;
                    } else {
                        resultDiv.innerHTML += '<h2 style="color: orange;">⚠ API Returned Error</h2>';
                        resultDiv.innerHTML += `<p>Message: ${result.message}</p>`;
                    }
                } catch (e) {
                    resultDiv.innerHTML += '<h2 style="color: red;">✗ Invalid JSON Response</h2>';
                    resultDiv.innerHTML += '<p>The API did not return valid JSON. This could be a PHP error.</p>';
                }

            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = `
                    <h2 style="color: red;">✗ Error</h2>
                    <p>${error.message}</p>
                    <h3>Possible Causes:</h3>
                    <ul>
                        <li>API file doesn't exist at api/submit_complaint.php</li>
                        <li>PHP errors preventing response</li>
                        <li>Incorrect file path</li>
                        <li>Server not running</li>
                    </ul>
                `;
            }
        }
    </script>
</body>
</html>
