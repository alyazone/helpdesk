# Multi-Unit Workflow System - Implementation Guide

## Overview
This update implements a three-unit workflow system for the helpdesk application, replacing the simple admin interface with role-based unit management.

## Workflow Flow

### 1. Unit Aduan Dalaman (En. Azri Hanis Bin Zul)
- **Login**: azri.hanis@jpbdselangor.gov.my (password: admin123)
- **Role**: Receives all new complaints first
- **Dashboard**: Shows statistics for complaints needing verification
- **Actions**:
  - Review complaint details
  - Update status to "Disahkan Unit Aduan"
  - Fill in:
    - Dimajukan ke (Forward to Unit Aset officer)
    - Tindakan Susulan
    - Tindakan/Kesimpulan
  - Generate "Dokumen Unit Aduan" (PDF/print format)
  - Forward to Unit Aset

### 2. Unit Aset (Pn. Maznah Binti Marzuki)
- **Login**: maznah@jpbdselangor.gov.my (password: admin123)
- **Role**: Receives forwarded complaints from Unit Aduan Dalaman
- **Dashboard**: Shows received complaints statistics
- **Actions**:
  - Review complaint and Dokumen Unit Aduan
  - Fill "Borang Aduan Kerosakan Aset Alih":
    - Bahagian I: Complaint details (auto-filled)
    - Bahagian II: Asset officer review (fill kos, syor, etc.)
  - Forward to Bahagian Pentadbiran & Kewangan

### 3. Bahagian Pentadbiran & Kewangan (Pn. Alia Binti Mohd Yusof)
- **Login**: alia.yusof@jpbdselangor.gov.my (password: admin123)
- **Role**: Acts as Pegawai Pelulus Aset (Asset Approval Officer)
- **Dashboard**: Shows complaints awaiting approval
- **Actions**:
  - Review Borang Aduan Kerosakan Aset Alih
  - Fill Bahagian III (Keputusan):
    - Status: Diluluskan/Ditolak
    - Ulasan
    - Signature (auto-generated by computer)

## Database Changes

### New Tables
1. **unit_aset_officers**: Stores Unit Aset officer details
2. **dokumen_unit_aduan**: Stores Unit Aduan Dalaman documents
3. **borang_kerosakan_aset**: Stores asset damage complaint forms
4. **workflow_actions**: Logs all workflow actions

### Modified Tables
1. **users**: Added `unit` field and new roles
2. **complaints**: Added workflow fields:
   - `workflow_status`: Tracks workflow progression
   - `unit_aduan_verified_by`, `unit_aduan_verified_at`
   - `dimajukan_ke`: Unit Aset officer ID
   - `tindakan_susulan`, `tindakan_kesimpulan`
   - `unit_aset_officer_id`, `unit_aset_reviewed_at`
   - `pegawai_pelulus_id`, `pegawai_pelulus_reviewed_at`
   - `pegawai_pelulus_status`

## File Structure

```
admin/
├── unit-aduan-dalaman/
│   ├── index.php (Dashboard)
│   ├── complaints.php (Complaint list)
│   ├── view_complaint.php (View and process complaint)
│   ├── process_complaint.php (Backend processing)
│   └── generate_dokumen.php (Generate Dokumen Unit Aduan)
│
├── unit-aset/
│   ├── index.php (Dashboard)
│   ├── complaints.php (Complaint list)
│   ├── view_complaint.php (View and fill Borang Bahagian II)
│   ├── process_borang.php (Backend processing)
│   └── generate_borang.php (Generate borang PDF)
│
└── bahagian-pentadbiran-kewangan/
    ├── index.php (Dashboard)
    ├── complaints.php (Complaint list with filters)
    ├── view_complaint.php (View and approve - fill Bahagian III)
    ├── process_approval.php (Backend approval processing)
    └── generate_borang_final.php (Generate final PDF with all sections)
```

## Installation Steps

### 1. Run Database Migration
```bash
mysql -u root -p helpdesk_db < migrations/add_multi_unit_workflow.sql
```

### 2. Test User Accounts
All test accounts use password: **admin123**

- **Unit Aduan Dalaman**: azri.hanis@jpbdselangor.gov.my
- **Unit Aset**: maznah@jpbdselangor.gov.my
- **Bahagian Pentadbiran & Kewangan**: alia.yusof@jpbdselangor.gov.my
- **Super Admin** (original): admin@jpbdselangor.gov.my

### 3. Access Points
- Login: http://localhost/helpdesk/login.html
- Each unit will be redirected to their respective dashboard after login

## Workflow Status Values

1. **baru**: New complaint (just submitted)
2. **disahkan_unit_aduan**: Verified by Unit Aduan Dalaman
3. **dimajukan_unit_aset**: Forwarded to Unit Aset
4. **dalam_semakan_unit_aset**: Under review by Unit Aset
5. **dimajukan_pegawai_pelulus**: Forwarded to Approval Officer
6. **diluluskan**: Approved
7. **ditolak**: Rejected
8. **selesai**: Completed

## Current Implementation Status

### ✅ Completed
- Database schema migration
- Role-based authentication system
- Login redirect based on role
- Unit Aduan Dalaman (Complete):
  - Dashboard with statistics
  - Complaint list page
  - View and process complaint page
  - Process complaint backend (verify and forward)
  - Generate Dokumen Unit Aduan (printable)
- Unit Aset (Partial):
  - Dashboard with statistics
  - Complaint list page

### ✅ Recently Completed
- Unit Aset (Complete):
  - View complaint and fill Borang Kerosakan Aset Alih
  - Process borang backend
  - Generate borang PDF
  - Forward to Pegawai Pelulus
- Bahagian Pentadbiran & Kewangan (Complete):
  - Dashboard with statistics
  - Complaint list with filters
  - View and approve page (fill Bahagian III)
  - Process approval backend
  - Final PDF generation with all sections

## Notes

1. All default passwords are `admin123` - **change in production!**
2. The system uses workflow_status to track complaint progression
3. Each unit has its own admin interface with specific permissions
4. Documents are generated in print-friendly HTML format
5. Email notifications can be added in future iterations

## Next Steps

1. Complete Unit Aset view and processing pages
2. Complete Bahagian Pentadbiran & Kewangan interface
3. Add PDF generation using a library like TCPDF or mPDF
4. Add email notifications at each workflow stage
5. Add workflow audit trail visibility
6. Implement proper testing with sample data

## Support

For questions or issues, contact the development team.
